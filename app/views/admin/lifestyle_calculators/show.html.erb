<h1>Lifestyle Calculator</h1>

<dl class="dl-horizontal">
  <dt>Created:</dt>
  <dd><%= @calculator.created_at %></dd>

  <dt>Updated:</dt>
  <dd><%= @calculator.updated_at %></dd>

  <dt>Countries:</dt>
  <dd><%= @calculator.countries.map { |c| ISO3166::Country.new(c) }.join(', ') %></dd>

  <dt>Version:</dt>
  <dd><%= @calculator.version || '<i>Draft</i>'.html_safe %></dd>
</dl>

<h3>Options</h3>

<dl class="dl-horizontal">
  <% [:region, :home, :heating, :house_age, :green_electricity, :food, :car_type].each do |question| %>
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title"><code><%= question %></code></h4>
      </div>
      <div class="panel-body">
        <% if (options = @calculator.send("#{question}_options"))&.any? %>
          <dl class="dl-horizontal">
            <% options.each do |answer, value| %>
              <dt><%= answer %></dt>
              <dd><code>=<%= value %></code></dd>
            <% end %>
          </dl>
        <% else %>
          <i>Question skipped</i>
        <% end %>
      </div>
    </div>
  <% end %>
</dl>

<h3>Formulas</h3>

<dl class="dl-horizontal">
  <% [:housing, :food, :car, :flights, :consumption, :public].each do |category| %>
    <dt><%= category %></dt>
    <dd><code>=<%= @calculator.send("#{category}_formula") %></code></dd>
  <% end %>
</dl>

<h2>Preview</h2>

<%= form_with url: lifestyle_footprints_path(format: :json), html: { 'data-controller': 'lifestyle-footprint' } do |f| %>
  <%= hidden_field_tag :lifestyle_calculator_id, @calculator.id %>

  <%= fields_for :answers do |fa| %>
    <% if @calculator.region_options&.any? %>
      <div class="form-group">
        <%= fa.label :region %>
        <%= fa.select :region, @calculator.region_options.keys, {}, class: 'form-control' %>
      </div>
    <% end %>

    <% if @calculator.home_options&.any? %>
      <div class="form-group">
        <%= fa.label :home %>
        <%= fa.select :home, @calculator.home_options.keys, {}, class: 'form-control' %>
      </div>
    <% end %>

    <% if @calculator.heating_options&.any? %>
      <div class="form-group">
        <%= fa.label :heating %>
        <%= fa.select :heating, @calculator.heating_options.keys, {}, class: 'form-control' %>
      </div>
    <% end %>

    <% if @calculator.house_age_options&.any? %>
      <div class="form-group">
        <%= fa.label :house_age %>
        <%= fa.select :house_age, @calculator.house_age_options.keys, {}, class: 'form-control' %>
      </div>
    <% end %>

    <% if @calculator.green_electricity_options&.any? %>
      <div class="form-group">
        <%= fa.label :green_electricity %>
        <%= fa.select :green_electricity, @calculator.green_electricity_options.keys, {}, class: 'form-control' %>
      </div>
    <% end %>

    <% if @calculator.food_options&.any? %>
      <div class="form-group">
        <%= fa.label :food %>
        <%= fa.select :food, @calculator.food_options.keys, {}, class: 'form-control' %>
      </div>
    <% end %>

    <% if @calculator.car_type_options&.any? %>
      <div class="form-group">
        <%= fa.label :car_type %>
        <%= fa.select :car_type, @calculator.car_type_options.keys, {}, class: 'form-control' %>
      </div>
    <% end %>

    <div class="form-group">
      <%= fa.label :car_distance %>
      <%= fa.text_field :car_distance, class: 'form-control' %>
    </div>

    <div class="form-group">
      <%= fa.label :flight_hours %>
      <%= fa.text_field :flight_hours, class: 'form-control' %>
    </div>
  <% end %>

  <%= f.submit 'Preview result', class: 'btn btn-primary', 'data-action': 'lifestyle-footprint#calculate' %>

  <div class="panel panel-default">
    <div class="panel-body">
      <p data-target="lifestyle-footprint.error" class="hidden-when-empty"></p>
      <dl>
        <dt>Housing</dt>
        <dd data-target="lifestyle-footprint.housingResult"></dd>
        <dt>Food</dt>
        <dd data-target="lifestyle-footprint.foodResult"></dd>
        <dt>Car</dt>
        <dd data-target="lifestyle-footprint.carResult"></dd>
        <dt>Flights</dt>
        <dd data-target="lifestyle-footprint.flightsResult"></dd>
        <dt>Consumption</dt>
        <dd data-target="lifestyle-footprint.consumptionResult"></dd>
        <dt>Public</dt>
        <dd data-target="lifestyle-footprint.publicResult"></dd>
        <dt>Total</dt>
        <dd data-target="lifestyle-footprint.total"></dd>
        <dt>Price (monthly)</dt>
        <dd data-target="lifestyle-footprint.price"></dd>
      </dl>
    </div>
  </div>
<% end %>

<hr>

<% if @calculator.version.nil? %>
  <%= link_to 'Edit draft', new_admin_lifestyle_calculator_path(countries: @calculator.countries), class: 'btn btn-default' %> &nbsp;
<% end %>
<%= link_to 'Back', admin_lifestyle_calculators_path, class: 'btn btn-link' %>
